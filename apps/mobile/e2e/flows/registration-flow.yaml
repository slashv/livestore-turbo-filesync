appId: com.livestore.todo
---
# Registration Flow - Tests user registration with gallery app

# Clear keychain (where expo-secure-store keeps auth tokens)
- clearKeychain

# Clear app state and stop the app
- launchApp:
    clearState: true
    stopApp: true

# Launch app fresh
- launchApp

# Step 1: Verify we're on the login screen
- assertVisible: "Sign In"

# Step 2: Toggle to registration mode
- tapOn:
    id: "toggle-auth-mode"

# Verify we're now in registration mode
- assertVisible: "Create Account"

# Step 3: Fill out registration form with unique user
- tapOn:
    id: "name-input"
- inputText: "E2E Mobile Registration User"
- tapOn:
    id: "email-input"
- inputText: ${new Date().getTime()}@test.local
- tapOn:
    id: "password-input"
- inputText: "password123"

# Step 4: Submit registration
- tapOn:
    id: "register-button"

# Dismiss iOS "Save Password" dialog if it appears
- runFlow:
    when:
      visible:
        text: ".*assword.*"
    commands:
      - tapOn:
          text: ".*ot Now.*"

# Step 5: Wait for gallery to load (verify we're logged in)
# The app now shows gallery instead of todos after login
- extendedWaitUntil:
    visible:
      id: "gallery"
    timeout: 15000

# Step 6: Verify gallery elements are visible
- assertVisible:
    id: "upload-button"

# Step 7: Verify empty state shows (clean user has no images)
- assertVisible:
    id: "empty-state"
